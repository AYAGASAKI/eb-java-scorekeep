packages:
  python:
    awscli: 1.11.79
container_commands:
  update-random-name:
    command: /tmp/update-lambda.sh
    leader_only: true

files:
  "/tmp/update-lambda.sh":
    mode: "000755"
    owner: ec2-user
    group: ec2-user
    content: |
      #!/bin/bash
      REGION=$(/opt/elasticbeanstalk/bin/get-config environment -k AWS_REGION)
      STAGINGDIR=$(/opt/elasticbeanstalk/bin/get-config container -k container_staging_dir)
      USERPOOL=$(/opt/elasticbeanstalk/bin/get-config environment -k USERPOOL_ID)
      aws lambda update-function-configuration --function-name scorekeep-confirm-user --environment "{\"Variables\": {\"USERPOOL_ID\": \"$USERPOOL\"} }" --region $REGION
      if [ $? -ne 0 ]
      then
      echo "Lambda function scorekeep-confirm-user not found"
      fi
      exit 0